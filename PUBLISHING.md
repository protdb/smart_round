# Инструкция по сборке и публикации пакета smart_round

В этом документе описан процесс сборки и публикации пакета smart_round в PyPI (тестовый и основной репозиторий).

## Подготовка к сборке

### 1. Установка необходимых инструментов

Убедитесь, что у вас установлены все необходимые инструменты для сборки и публикации пакета:

```bash
pip install build twine setuptools wheel
```

### 2. Проверка структуры проекта

Перед сборкой убедитесь, что структура проекта корректна:

```
smart_round/
├── __init__.py             # Основные функции пакета
├── py.typed (опционально)  # Маркер поддержки статической типизации
pyproject.toml              # Конфигурация проекта и сборки
README.md                   # Описание проекта
LICENSE                     # Файл лицензии (рекомендуется создать)
```

### 3. Обновление версии

Перед каждой публикацией обновите версию пакета в файле `pyproject.toml`:

```toml
[project]
name = "smart_round"
version = "0.1.0"  # Измените на новую версию
```

## Сборка пакета

### 1. Создание дистрибутива

Для создания дистрибутива выполните следующую команду в корневой директории проекта:

```bash
python -m build
```

Эта команда создаст папку `dist/` с двумя типами дистрибутивов:
- `.tar.gz` - архив исходного кода (source distribution)
- `.whl` - скомпилированный пакет (wheel distribution)

## Публикация в тестовом PyPI

Рекомендуется сначала опубликовать пакет в тестовом репозитории PyPI для проверки.

### 1. Создание аккаунта на Test PyPI

Если у вас еще нет аккаунта на Test PyPI, зарегистрируйтесь на сайте:
https://test.pypi.org/account/register/

### 2. Создание файла .pypirc (опционально)

Для удобства можно создать файл `.pypirc` в вашей домашней директории:

```
[distutils]
index-servers =
    pypi
    testpypi

[pypi]
username = __token__
password = ваш_токен_pypi

[testpypi]
repository = https://test.pypi.org/legacy/
username = __token__
password = ваш_тестовый_токен_pypi
```

### 3. Загрузка пакета в Test PyPI

```bash
python -m twine upload --repository testpypi dist/*
```

Если вы не создавали файл `.pypirc`, введите свои учетные данные при запросе или используйте токены:

```bash
python -m twine upload --repository-url https://test.pypi.org/legacy/ dist/*
```

### 4. Проверка установки с Test PyPI

После публикации проверьте, что пакет корректно устанавливается из Test PyPI:

```bash
pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple/ smart_round
```

Обратите внимание: параметр `--extra-index-url` нужен для установки зависимостей из основного PyPI.

## Публикация в основном PyPI

После успешной проверки в Test PyPI можно публиковать в основном репозитории.

### 1. Создание аккаунта на PyPI

Если у вас еще нет аккаунта на PyPI, зарегистрируйтесь на сайте:
https://pypi.org/account/register/

### 2. Получение токена API для PyPI

1. Войдите в свой аккаунт на PyPI
2. Перейдите в настройки аккаунта → API tokens
3. Создайте токен с нужными правами (рекомендуется "Upload to project" или "Entire account")

### 3. Загрузка пакета в PyPI

```bash
python -m twine upload dist/*
```

Если вы не создавали файл `.pypirc`, введите свои учетные данные при запросе или используйте токен.

### 4. Проверка установки

Убедитесь, что пакет корректно устанавливается из основного PyPI:

```bash
pip install smart_round
```

## Важные замечания

### Зависимости

В пакете smart_round зависимости NumPy и pandas являются опциональными. Они требуются только для определенных функций:

- NumPy требуется для функции `format_value`
- pandas требуется для функции `format_dataframe`

При установке пользователи могут указать нужные зависимости:

```bash
# Базовая установка (только smart_round без зависимостей)
pip install smart_round

# С поддержкой NumPy
pip install smart_round[numpy]

# С поддержкой pandas (также устанавливает NumPy)
pip install smart_round[pandas]

# Полная установка со всеми зависимостями
pip install smart_round[all]
```

### Обновление существующей версии

PyPI **не позволяет** перезаписывать существующие версии пакета. Если вам нужно исправить ошибку, вы должны увеличить номер версии в `pyproject.toml` (например, с `0.1.0` на `0.1.1`) и загрузить новую версию.

### Удаление некорректных версий

Если вам необходимо удалить некорректную версию с PyPI:

1. Войдите на сайт PyPI
2. Перейдите на страницу своего проекта
3. Перейдите на вкладку "Manage"
4. Нажмите на кнопку "Options" рядом с версией
5. Выберите "Удалить файлы" или "Удалить версию"

Обратите внимание, что после удаления версии вы **не сможете** повторно загрузить пакет с тем же номером версии.